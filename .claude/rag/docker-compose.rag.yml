# Adaptive RAG Service - Docker Compose
# Mount your project and query via REST API

services:
  rag-service:
    build:
      context: .
      dockerfile: Dockerfile
    image: adaptive-rag:latest
    container_name: adaptive-rag
    volumes:
      # Mount your project here
      - ${PROJECT_PATH:-.}:/project:ro
      # Persist vector database
      - rag-data:/data/chroma_db
    environment:
      - PROJECT_ROOT=/project
      - RAG_REST_API=true
      - CHROMA_PERSIST_DIR=/data/chroma_db
      # FedRAMP mode - no external calls
      - AIR_GAPPED=${AIR_GAPPED:-false}
      - FEDRAMP_ENVIRONMENT=${FEDRAMP:-false}
    ports:
      - "${RAG_PORT:-8080}:8080"
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8080/health"]
      interval: 30s
      timeout: 10s
      retries: 3
    restart: unless-stopped

volumes:
  rag-data:
    driver: local
